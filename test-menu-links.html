<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test des liens du menu</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .result { margin-top: 10px; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Test des liens du menu BookYourCoach</h1>
    
    <div class="test-section info">
        <h3>Instructions</h3>
        <p>1. Ouvrez l'application à <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></p>
        <p>2. Connectez-vous avec un des comptes de test ci-dessous</p>
        <p>3. Vérifiez que les liens du menu en haut à droite fonctionnent</p>
    </div>

    <div class="test-section">
        <h3>Comptes de test</h3>
        <div>
            <h4>Admin (peut tout faire)</h4>
            <p><strong>Email:</strong> admin@bookyourcoach.com</p>
            <p><strong>Mot de passe:</strong> password</p>
            <p><strong>Liens attendus:</strong> Tableau de bord, Espace Enseignant, Espace Étudiant, Profil, Administration</p>
        </div>
        
        <div>
            <h4>Étudiant</h4>
            <p><strong>Email:</strong> student@test.com</p>
            <p><strong>Mot de passe:</strong> password</p>
            <p><strong>Liens attendus:</strong> Tableau de bord, Espace Étudiant, Profil</p>
        </div>
    </div>

    <div class="test-section">
        <h3>Tests à effectuer</h3>
        <ol>
            <li><strong>Connexion Admin:</strong>
                <ul>
                    <li>Se connecter avec admin@bookyourcoach.com</li>
                    <li>Vérifier que tous les liens du menu sont visibles</li>
                    <li>Cliquer sur "Espace Enseignant" → doit aller vers /teacher/dashboard</li>
                    <li>Cliquer sur "Espace Étudiant" → doit aller vers /student/dashboard</li>
                    <li>Cliquer sur "Administration" → doit aller vers /admin</li>
                </ul>
            </li>
            <li><strong>Connexion Étudiant:</strong>
                <ul>
                    <li>Se connecter avec student@test.com</li>
                    <li>Vérifier que seuls les liens appropriés sont visibles</li>
                    <li>Cliquer sur "Espace Étudiant" → doit aller vers /student/dashboard</li>
                    <li>Vérifier que "Espace Enseignant" et "Administration" ne sont PAS visibles</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="test-section">
        <h3>Résultats attendus</h3>
        <div class="result success">
            <strong>✅ Succès:</strong> Les liens du menu fonctionnent correctement selon les rôles
        </div>
        <div class="result error">
            <strong>❌ Échec:</strong> Les liens ne fonctionnent pas ou les permissions sont incorrectes
        </div>
    </div>

    <div class="test-section">
        <h3>Corrections apportées</h3>
        <ul>
            <li>✅ Middleware <code>student.ts</code> corrigé pour utiliser <code>canActAsStudent</code></li>
            <li>✅ Middleware <code>teacher.ts</code> utilise déjà <code>canActAsTeacher</code></li>
            <li>✅ Store d'authentification utilise les bonnes propriétés du backend</li>
            <li>✅ API backend retourne les bonnes capacités utilisateur</li>
        </ul>
    </div>

    <script>
        // Test automatique des endpoints
        async function testAPI() {
            const results = document.getElementById('api-results');
            results.innerHTML = '<p>Test des endpoints API...</p>';
            
            try {
                // Test endpoint auth/user
                const response = await fetch('http://localhost:8081/api/auth/user', {
                    headers: {
                        'Authorization': 'Bearer 20|fLqjmhzwK3WP8JKQVJYbW6KOIg9gItBf0NlBv1Dg46aeed34'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    results.innerHTML = `
                        <div class="result success">
                            <strong>✅ API Backend:</strong> Fonctionne correctement<br>
                            <strong>Utilisateur:</strong> ${data.user.name} (${data.user.role})<br>
                            <strong>Capacités:</strong> Teacher: ${data.user.can_act_as_teacher}, Student: ${data.user.can_act_as_student}
                        </div>
                    `;
                } else {
                    results.innerHTML = `<div class="result error"><strong>❌ API Backend:</strong> Erreur ${response.status}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="result error"><strong>❌ API Backend:</strong> ${error.message}</div>`;
            }
        }
        
        // Test automatique du frontend
        async function testFrontend() {
            const results = document.getElementById('frontend-results');
            results.innerHTML = '<p>Test du frontend...</p>';
            
            try {
                const response = await fetch('http://localhost:3000');
                if (response.ok) {
                    results.innerHTML = `<div class="result success"><strong>✅ Frontend:</strong> Accessible sur http://localhost:3000</div>`;
                } else {
                    results.innerHTML = `<div class="result error"><strong>❌ Frontend:</strong> Erreur ${response.status}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="result error"><strong>❌ Frontend:</strong> ${error.message}</div>`;
            }
        }
        
        // Lancer les tests au chargement
        window.onload = function() {
            testAPI();
            testFrontend();
        };
    </script>

    <div class="test-section">
        <h3>Résultats des tests automatiques</h3>
        <div id="api-results"></div>
        <div id="frontend-results"></div>
    </div>
</body>
</html>
