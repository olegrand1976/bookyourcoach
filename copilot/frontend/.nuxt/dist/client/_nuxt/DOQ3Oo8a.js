import{_ as V}from"./Bm8-yRUG.js";import{e as A,j as S,k as q,r as y,f as R,c as n,a as s,d as _,b as U,w as F,l as T,m as k,p as b,v as E,i as t,q as j,F as z,s as B,t as M,o as l,n as x,x as I}from"./B2BDWZP7.js";import{u as L}from"./C4hk_EZT.js";const D={class:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},O={class:"max-w-md w-full space-y-8"},P={class:"mt-2 text-center text-sm text-gray-600"},$={class:"rounded-md shadow-sm -space-y-px"},G={class:"flex items-center justify-between"},H={class:"flex items-center"},J=["disabled"],K={key:0},Q={key:1},W={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-md p-4"},X={class:"text-sm text-yellow-700"},Y={class:"list-disc list-inside"},Z={key:1,class:"bg-red-50 border border-red-200 rounded-md p-4"},ee={class:"text-sm text-red-600"},ae={__name:"login",setup(se){const u=A(),v=L();S();const r=q({email:"",password:"",remember:!1}),m=y(!1),c=y(""),p=y([]),C=()=>{const i=[];return r.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)||i.push("Format email invalide"):i.push("Email requis"),r.password?r.password.length<6&&i.push("Mot de passe trop court (minimum 6 caractères)"):i.push("Mot de passe requis"),i},N=async()=>{var e,f,o,g,w,h;m.value=!0,c.value="",p.value=[];const i=C();if(i.length>0){p.value=i,m.value=!1;return}try{await u.login({email:r.email,password:r.password}),v.success("Connexion réussie"),u.isAdmin?await x("/admin"):u.isTeacher?await x("/teacher"):await x("/dashboard")}catch(a){console.error("Erreur de connexion complète:",a),console.error("Response data:",(e=a.response)==null?void 0:e.data),console.error("Response status:",(f=a.response)==null?void 0:f.status),console.error("URL de base API:",I().public.apiBase);let d="Une erreur est survenue";(g=(o=a.response)==null?void 0:o.data)!=null&&g.message?d=a.response.data.message:a.code==="ECONNREFUSED"||a.message.includes("Network Error")?d="Impossible de se connecter au serveur. Vérifiez que l'API est accessible.":((w=a.response)==null?void 0:w.status)===422?d="Informations de connexion invalides":((h=a.response)==null?void 0:h.status)===401?d="Email ou mot de passe incorrect":d=`Erreur: ${a.message||"Erreur inconnue"}`,c.value=d,v.error("Erreur de connexion")}finally{m.value=!1}};return R(()=>{u.isAuthenticated&&x("/dashboard")}),(i,e)=>{const f=V;return l(),n("div",D,[s("div",O,[s("div",null,[e[5]||(e[5]=s("h2",{class:"mt-6 text-center text-3xl font-extrabold text-gray-900"}," Connexion à votre compte ",-1)),s("p",P,[e[4]||(e[4]=_(" Ou ",-1)),U(f,{to:"/register",class:"font-medium text-primary-600 hover:text-primary-500"},{default:F(()=>e[3]||(e[3]=[_(" créez un nouveau compte ",-1)])),_:1,__:[3]})])]),s("form",{class:"mt-8 space-y-6",onSubmit:T(N,["prevent"])},[s("div",$,[s("div",null,[e[6]||(e[6]=s("label",{for:"email",class:"sr-only"},"Adresse email",-1)),b(s("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=o=>t(r).email=o),name:"email",type:"email",autocomplete:"email",required:"",class:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm",placeholder:"Adresse email"},null,512),[[E,t(r).email]])]),s("div",null,[e[7]||(e[7]=s("label",{for:"password",class:"sr-only"},"Mot de passe",-1)),b(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=o=>t(r).password=o),name:"password",type:"password",autocomplete:"current-password",required:"",class:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm",placeholder:"Mot de passe"},null,512),[[E,t(r).password]])])]),s("div",G,[s("div",H,[b(s("input",{id:"remember-me","onUpdate:modelValue":e[2]||(e[2]=o=>t(r).remember=o),name:"remember-me",type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[j,t(r).remember]]),e[8]||(e[8]=s("label",{for:"remember-me",class:"ml-2 block text-sm text-gray-900"}," Se souvenir de moi ",-1))]),e[9]||(e[9]=s("div",{class:"text-sm"},[s("a",{href:"#",class:"font-medium text-primary-600 hover:text-primary-500"}," Mot de passe oublié ? ")],-1))]),s("div",null,[s("button",{type:"submit",disabled:t(m),class:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50"},[t(m)?(l(),n("span",K,"Connexion en cours...")):(l(),n("span",Q,"Se connecter"))],8,J)]),t(p).length>0?(l(),n("div",W,[s("div",X,[s("ul",Y,[(l(!0),n(z,null,B(t(p),o=>(l(),n("li",{key:o},M(o),1))),128))])])])):k("",!0),t(c)?(l(),n("div",Z,[s("div",ee,M(t(c)),1)])):k("",!0)],32)])])}}};export{ae as default};
