{"version":3,"file":"profile--ko0HkIT.js","sources":["../../../../pages/profile.vue"],"sourcesContent":["<template>\n    <div class=\"min-h-screen bg-gray-50\">\n        <div class=\"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8\">\n            <!-- Header -->\n            <div class=\"mb-8\">\n                <h1 class=\"text-3xl font-bold text-gray-900 flex items-center\">\n                    <span class=\"text-4xl mr-3\">üë§</span>\n                    Mon Profil\n                </h1>\n                <p class=\"mt-2 text-gray-600\">G√©rez vos informations personnelles et pr√©f√©rences</p>\n            </div>\n\n            <!-- Profile Form -->\n            <div class=\"bg-white shadow-lg rounded-lg border border-gray-200\">\n                <form @submit.prevent=\"updateProfile\" class=\"space-y-6 p-6\">\n                    <!-- Personal Information -->\n                    <div class=\"border-b border-gray-200 pb-6\">\n                        <h2 class=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                            <span class=\"text-xl mr-2\">üèá</span>\n                            Informations personnelles\n                        </h2>\n\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Nom complet</label>\n                                <input v-model=\"form.name\" type=\"text\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                                    placeholder=\"Votre nom complet\" required />\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Email</label>\n                                <input v-model=\"form.email\" type=\"email\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                                    placeholder=\"votre@email.com\" required />\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">T√©l√©phone</label>\n                                <input v-model=\"form.phone\" type=\"tel\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                                    placeholder=\"+33 6 12 34 56 78\" />\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Date de naissance</label>\n                                <input v-model=\"form.birth_date\" type=\"date\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\" />\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Role-specific Information -->\n                    <div v-if=\"authStore.isAdmin\" class=\"border-b border-gray-200 pb-6\">\n                        <h2 class=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                            <EquestrianIcon icon=\"trophy\" class=\"mr-2 text-primary-600\" :size=\"20\" />\n                            Administration\n                        </h2>\n                        <div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                            <p class=\"text-blue-800\">\n                                <strong>R√¥le :</strong> Administrateur syst√®me\n                            </p>\n                            <p class=\"text-blue-700 text-sm mt-1\">\n                                Acc√®s complet aux fonctionnalit√©s de gestion de la plateforme\n                            </p>\n                        </div>\n                    </div>\n\n                    <div v-if=\"authStore.isTeacher\" class=\"border-b border-gray-200 pb-6\">\n                        <h2 class=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                            <EquestrianIcon icon=\"saddle\" class=\"mr-2 text-primary-600\" :size=\"20\" />\n                            Informations d'enseignant\n                        </h2>\n\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Sp√©cialit√©s</label>\n                                <textarea v-model=\"form.specialties\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\" rows=\"3\"\n                                    placeholder=\"Dressage, saut d'obstacles, √©quitation western...\"></textarea>\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Exp√©rience (ann√©es)</label>\n                                <input v-model=\"form.experience_years\" type=\"number\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\" min=\"0\"\n                                    placeholder=\"10\" />\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Certifications</label>\n                                <textarea v-model=\"form.certifications\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\" rows=\"2\"\n                                    placeholder=\"BPJEPS, Galop 7, FFE...\"></textarea>\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Tarif horaire (‚Ç¨)</label>\n                                <input v-model=\"form.hourly_rate\" type=\"number\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\" min=\"0\" step=\"5\"\n                                    placeholder=\"45\" />\n                            </div>\n                        </div>\n                    </div>\n\n                    <div v-if=\"authStore.isStudent\" class=\"border-b border-gray-200 pb-6\">\n                        <h2 class=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                            <EquestrianIcon icon=\"horseshoe\" class=\"mr-2 text-primary-600\" :size=\"20\" />\n                            Informations d'√©l√®ve\n                        </h2>\n\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Niveau √©questre</label>\n                                <select v-model=\"form.riding_level\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\">\n                                    <option value=\"\">S√©lectionnez votre niveau</option>\n                                    <option value=\"debutant\">D√©butant</option>\n                                    <option value=\"galop1\">Galop 1</option>\n                                    <option value=\"galop2\">Galop 2</option>\n                                    <option value=\"galop3\">Galop 3</option>\n                                    <option value=\"galop4\">Galop 4</option>\n                                    <option value=\"galop5\">Galop 5</option>\n                                    <option value=\"galop6\">Galop 6</option>\n                                    <option value=\"galop7\">Galop 7</option>\n                                    <option value=\"expert\">Expert</option>\n                                </select>\n                            </div>\n\n                            <div>\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Pr√©f√©rences de cours</label>\n                                <textarea v-model=\"form.course_preferences\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\" rows=\"2\"\n                                    placeholder=\"Dressage, saut, balade...\"></textarea>\n                            </div>\n\n                            <div class=\"md:col-span-2\">\n                                <label class=\"block text-sm font-medium text-gray-700 mb-2\">Contact d'urgence</label>\n                                <input v-model=\"form.emergency_contact\" type=\"text\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                                    placeholder=\"Nom et t√©l√©phone du contact d'urgence\" />\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Actions -->\n                    <div class=\"flex justify-end space-x-4 pt-6\">\n                        <button type=\"button\" @click=\"resetForm\" class=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\" :disabled=\"loading\">\n                            Annuler\n                        </button>\n                        <button type=\"submit\" class=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent flex items-center\" :disabled=\"loading\">\n                            <span v-if=\"loading\" class=\"mr-2\">\n                                <svg class=\"animate-spin h-4 w-4\" viewBox=\"0 0 24 24\">\n                                    <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\"\n                                        stroke-width=\"4\" fill=\"none\" />\n                                    <path class=\"opacity-75\" fill=\"currentColor\"\n                                        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n                                </svg>\n                            </span>\n                            Sauvegarder\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script setup>\ndefinePageMeta({\n    middleware: 'auth'\n})\n\nconst authStore = useAuthStore()\nconst toast = useToast()\n\nconst loading = ref(false)\n\n// Form data\nconst form = reactive({\n    name: '',\n    email: '',\n    phone: '',\n    birth_date: '',\n    // Teacher specific\n    specialties: '',\n    experience_years: 0,\n    certifications: '',\n    hourly_rate: 0,\n    // Student specific\n    riding_level: '',\n    course_preferences: '',\n    emergency_contact: ''\n})\n\n// Load user profile data\nconst loadProfileData = async () => {\n    console.log('loadProfileData called, user:', authStore.user)\n\n    if (!authStore.user) {\n        console.log('No user found in authStore, trying to fetch from API')\n\n        // Essayer de r√©cup√©rer l'utilisateur depuis l'API si on a un token\n        const tokenCookie = useCookie('auth-token')\n        if (tokenCookie.value) {\n            try {\n                const { $api } = useNuxtApp()\n                const response = await $api.get('/auth/user')\n\n                // Mettre √† jour l'authStore avec les donn√©es utilisateur\n                authStore.user = response.data\n                authStore.isAuthenticated = true\n\n                console.log('User fetched from API:', response.data)\n            } catch (error) {\n                console.error('Erreur lors de la r√©cup√©ration de l\\'utilisateur:', error)\n                return\n            }\n        } else {\n            return\n        }\n    }\n\n    // Pr√©charger les donn√©es utilisateur de base\n    console.log('Preloading user data:', authStore.user.name, authStore.user.email)\n    form.name = authStore.user.name || ''\n    form.email = authStore.user.email || ''\n\n    // Load additional profile data from API\n    try {\n        const { $api } = useNuxtApp()\n        const response = await $api.get('/profile-test')\n\n        if (response.data.profile) {\n            const profile = response.data.profile\n            form.phone = profile.phone || ''\n\n            // Format birth_date for input[type=\"date\"] (YYYY-MM-DD)\n            if (profile.date_of_birth) {\n                const date = new Date(profile.date_of_birth)\n                form.birth_date = date.toISOString().split('T')[0]\n            } else {\n                form.birth_date = ''\n            }\n\n            // Teacher specific data\n            if (authStore.isTeacher && response.data.teacher) {\n                const teacher = response.data.teacher\n                form.specialties = teacher.specialties || ''\n                form.experience_years = teacher.experience_years || 0\n                form.certifications = teacher.certifications || ''\n                form.hourly_rate = teacher.hourly_rate || 0\n            }\n\n            // Student specific data\n            if (authStore.isStudent && response.data.student) {\n                const student = response.data.student\n                form.riding_level = student.level || ''\n                form.course_preferences = student.course_preferences || ''\n                form.emergency_contact = student.emergency_contact || ''\n            }\n        }\n    } catch (error) {\n        console.error('Erreur lors du chargement du profil:', error)\n        toast.error('Erreur lors du chargement du profil')\n    }\n}\n\n// Charger les donn√©es au montage\nonMounted(async () => {\n    console.log('onMounted - authStore.user:', authStore.user)\n    console.log('onMounted - authStore.isAuthenticated:', authStore.isAuthenticated)\n\n    // Toujours essayer de charger les donn√©es\n    await loadProfileData()\n})\n\n// Observer les changements de l'utilisateur pour pr√©charger les donn√©es\nwatch(() => authStore.user, (newUser, oldUser) => {\n    console.log('Watch triggered - newUser:', newUser, 'oldUser:', oldUser)\n    if (newUser && newUser !== oldUser) {\n        loadProfileData()\n    }\n}, { immediate: true })\n\nconst updateProfile = async () => {\n    loading.value = true\n\n    try {\n        const { $api } = useNuxtApp()\n        await $api.put('/profile-test', form)\n\n        toast.success('Profil mis √† jour avec succ√®s')\n\n        // Update auth store with new user data\n        authStore.user.name = form.name\n        authStore.user.email = form.email\n\n    } catch (error) {\n        console.error('Erreur lors de la mise √† jour:', error)\n        toast.error('Erreur lors de la mise √† jour du profil')\n    } finally {\n        loading.value = false\n    }\n}\n\nconst resetForm = () => {\n    // Reset form to initial values\n    if (authStore.user) {\n        form.name = authStore.user.name || ''\n        form.email = authStore.user.email || ''\n        // Recharger toutes les donn√©es du profil\n        loadProfileData()\n    }\n}\n</script>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderAttr","_unref","_ssrInterpolate","_ssrIncludeBooleanAttr","_ssrLooseContain","_ssrLooseEqual"],"mappings":"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"}