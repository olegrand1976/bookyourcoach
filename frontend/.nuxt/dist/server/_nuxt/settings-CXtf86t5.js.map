{"version":3,"file":"settings-CXtf86t5.js","sources":["../../../../pages/admin/settings.vue"],"sourcesContent":["<template>\n    <div class=\"min-h-screen bg-gray-50\">\n        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900 mb-2\">Param√®tres Syst√®me</h1>\n            <p class=\"mb-6 text-gray-600\">Configuration g√©n√©rale de la plateforme</p>\n\n            <!-- Param√®tres g√©n√©raux -->\n            <div class=\"bg-white rounded-lg shadow-lg p-6 mb-8\">\n                <h2 class=\"text-xl font-semibold mb-4\">Param√®tres g√©n√©raux</h2>\n                <form @submit.prevent=\"saveGeneralSettings\">\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-gray-700 mb-1\">Nom de la plateforme</label>\n                            <input v-model=\"settings.platform_name\" class=\"input-field\" required />\n                        </div>\n                        <div>\n                            <label class=\"block text-gray-700 mb-1\">Email de contact</label>\n                            <input v-model=\"settings.contact_email\" class=\"input-field\" required type=\"email\" />\n                        </div>\n                        <div>\n                            <label class=\"block text-gray-700 mb-1\">T√©l√©phone de contact</label>\n                            <input v-model=\"settings.contact_phone\" class=\"input-field\" />\n                        </div>\n                        <div>\n                            <label class=\"block text-gray-700 mb-1\">Fuseau horaire</label>\n                            <input v-model=\"settings.timezone\" class=\"input-field\" />\n                        </div>\n                        <div class=\"md:col-span-2\">\n                            <label class=\"block text-gray-700 mb-1\">Adresse de la soci√©t√©</label>\n                            <textarea v-model=\"settings.company_address\" class=\"input-field\" rows=\"3\"></textarea>\n                        </div>\n                    </div>\n\n                    <!-- Gestion du logo -->\n                    <div class=\"mt-6 border-t pt-6\">\n                        <h3 class=\"text-lg font-semibold mb-4\">Logo de la plateforme</h3>\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                                <label class=\"block text-gray-700 mb-1\">URL du logo</label>\n                                <input v-model=\"settings.logo_url\" class=\"input-field\" placeholder=\"https://...\" />\n                                <div class=\"mt-2\">\n                                    <label class=\"block text-gray-700 mb-1\">Uploader un logo</label>\n                                    <input type=\"file\" accept=\"image/*\" @change=\"onLogoUpload\" class=\"input-field\" />\n                                </div>\n                            </div>\n                            <div v-if=\"settings.logo_url\" class=\"flex flex-col items-center\">\n                                <span class=\"text-sm text-gray-600 mb-2\">Aper√ßu actuel</span>\n                                <div class=\"border rounded-lg p-4 bg-gray-50\">\n                                    <img :src=\"settings.logo_url\" alt=\"Logo\" class=\"h-16 w-auto max-w-full\" />\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"mt-6 flex justify-end\">\n                        <button type=\"submit\" class=\"btn-primary\" :disabled=\"loading\">\n                            {{ loading ? 'Sauvegarde...' : 'Sauvegarder' }}\n                        </button>\n                    </div>\n                </form>\n            </div>\n\n            <!-- Statistiques syst√®me -->\n            <div class=\"bg-white rounded-lg shadow-lg p-6\">\n                <h2 class=\"text-xl font-semibold mb-4\">Informations syst√®me</h2>\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <div class=\"bg-blue-50 p-4 rounded\">\n                        <div class=\"text-2xl font-bold text-blue-600\">{{ stats.users || 0 }}</div>\n                        <div class=\"text-sm text-gray-600\">Utilisateurs total</div>\n                    </div>\n                    <div class=\"bg-green-50 p-4 rounded\">\n                        <div class=\"text-2xl font-bold text-green-600\">{{ stats.teachers || 0 }}</div>\n                        <div class=\"text-sm text-gray-600\">Enseignants</div>\n                    </div>\n                    <div class=\"bg-orange-50 p-4 rounded\">\n                        <div class=\"text-2xl font-bold text-orange-600\">{{ stats.students || 0 }}</div>\n                        <div class=\"text-sm text-gray-600\">√âtudiants</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script setup>\ndefinePageMeta({\n    middleware: ['auth', 'admin']\n})\n\nconst loading = ref(false)\n\n// Utiliser le composable de param√®tres global\nconst { settings, loadSettings, saveSettings } = useSettings()\n\nconst stats = ref({\n    users: 0,\n    teachers: 0,\n    students: 0\n})\n\n// Charger les statistiques\nconst loadStats = async () => {\n    try {\n        const { $api } = useNuxtApp()\n        const response = await $api.get('/admin/stats')\n        if (response.data) {\n            stats.value = response.data\n        }\n    } catch (error) {\n        console.error('Erreur lors du chargement des statistiques:', error)\n    }\n}\n\n// Sauvegarder les param√®tres g√©n√©raux\nconst saveGeneralSettings = async () => {\n    loading.value = true\n    try {\n        console.log('üîß [SETTINGS] D√©but sauvegarde des param√®tres:', settings.value)\n\n        // Utiliser le composable global pour sauvegarder ET mettre √† jour le header\n        const success = await saveSettings(settings.value)\n\n        if (success) {\n            console.log('‚úÖ [SETTINGS] Param√®tres sauvegard√©s avec succ√®s')\n            alert('Param√®tres sauvegard√©s avec succ√®s ! Le nom de la plateforme est maintenant mis √† jour dans le header.')\n        } else {\n            alert('Erreur lors de la sauvegarde. Consultez la console pour plus de d√©tails.')\n        }\n    } catch (error) {\n        console.error('‚ùå [SETTINGS] Erreur lors de la sauvegarde:', error)\n        alert('Erreur lors de la sauvegarde. Consultez la console pour plus de d√©tails.')\n    } finally {\n        loading.value = false\n    }\n}\n\n// Upload du logo\nconst onLogoUpload = async (event) => {\n    const target = event.target\n    const files = target.files\n    if (!files || files.length === 0) return\n\n    const file = files[0]\n    const formData = new FormData()\n    formData.append('logo', file)\n\n    try {\n        const { $api } = useNuxtApp()\n        const response = await $api.post('/admin/upload-logo', formData, {\n            headers: {\n                'Content-Type': 'multipart/form-data'\n            }\n        })\n\n        if (response.data?.logo_url) {\n            settings.value.logo_url = response.data.logo_url\n            console.log('‚úÖ Logo upload√© avec succ√®s:', response.data.logo_url)\n        }\n    } catch (error) {\n        console.error('‚ùå Erreur lors de l\\'upload du logo:', error)\n        alert('Erreur lors de l\\'upload du logo')\n    }\n}\n\n// Initialisation au montage du composant\nonMounted(() => {\n    loadSettings()\n    loadStats()\n})\n</script>"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderAttr","_unref","_ssrInterpolate"],"mappings":";;;;;;;;;;;;;;;;;;;AAyFA,UAAM,UAAU,IAAI,KAAK;AAGzB,UAAM,EAAE,UAAU,cAAc,aAAY,IAAK,YAAW;AAE5D,UAAM,QAAQ,IAAI;AAAA,MACd,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACd,CAAC;;mBAjGQA,eAAAC,WAAA,EAAA,OAAM,0BAAyB,GAAA,MAAA,CAAA,2cAYIC,cAAA,SAAAC,MAAA,QAAA,EAAS,aAAa,mHAItBD,cAAA,SAAAC,MAAA,QAAA,EAAS,aAAa,oIAItBD,cAAA,SAAAC,MAAA,QAAA,EAAS,aAAa,wGAItBD,cAAA,SAAAC,MAAA,QAAA,EAAS,QAAQ,sKAIdC,eAAAD,MAAA,QAAA,EAAS,eAAe,qPAUvBD,cAAA,SAAAC,MAAA,QAAA,EAAS,QAAQ;AAM1B,UAAAA,MAAA,QAAA,EAAS,UAAQ;sLAGd,OAAKA,MAAA,QAAA,EAAS,QAAQ,CAAA,yDAAA;AAAA;;;6HAOaA,MAAA,OAAA,CAAO,IAAA,cAAA,qBACrDA,MAAA,OAAA,IAAO,kBAAA,aAAA,oRAWmCC,eAAAD,MAAA,KAAA,EAAM,SAAK,CAAA,+JAIVC,eAAAD,MAAA,KAAA,EAAM,YAAQ,CAAA,0JAIbC,eAAAD,MAAA,KAAA,EAAM,YAAQ,CAAA;;;;;;;;;;"}