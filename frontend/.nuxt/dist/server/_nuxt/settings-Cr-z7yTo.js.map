{"version":3,"file":"settings-Cr-z7yTo.js","sources":["../../../../composables/useSettings.ts","../../../../pages/admin/settings.vue"],"sourcesContent":["import { ref, readonly } from 'vue'\n\n/**\n * Composable pour la gestion des param√®tres syst√®me\n */\nexport const useSettings = () => {\n    // √âtat r√©actif pour les param√®tres\n    const settings = ref({\n        platform_name: 'activibe',\n        contact_email: 'contact@activibe.fr',\n        contact_phone: '+32 2 123 45 67',\n        company_address: 'Rue de l\\'√âquitation 123\\n1000 Bruxelles\\nBelgique',\n        timezone: 'Europe/Brussels',\n        logo_url: '/logo-activibe.svg',\n        favicon_url: '/favicon.ico'\n    })\n\n    // Charger les param√®tres depuis l'API\n    const loadSettings = async () => {\n        try {\n            const { $api } = useNuxtApp()\n            const response = await $api.get('/admin/settings/general')\n\n            if (response.data) {\n                settings.value = { ...settings.value, ...response.data }\n            }\n        } catch (error) {\n            console.warn('Impossible de charger les param√®tres:', error)\n            // Les valeurs par d√©faut sont conserv√©es\n        }\n    }\n\n    // Sauvegarder les param√®tres\n    const saveSettings = async (newSettings: Partial<typeof settings.value>) => {\n        try {\n            const { $api } = useNuxtApp()\n            const response = await $api.put('/admin/settings/general', newSettings)\n\n            if (response.data?.message) {\n                settings.value = { ...settings.value, ...newSettings }\n                console.log('‚úÖ Param√®tres sauvegard√©s:', response.data.message)\n                return true\n            }\n            return false\n        } catch (error) {\n            console.error('‚ùå Erreur lors de la sauvegarde:', error)\n            return false\n        }\n    }\n\n    return {\n        settings, // Retir√©: readonly()\n        loadSettings,\n        saveSettings\n    }\n}\n","<template>\n    <div class=\"min-h-screen bg-gray-50\">\n        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <h1 class=\"text-3xl font-bold text-gray-900 mb-2\">Param√®tres Syst√®me</h1>\n            <p class=\"mb-6 text-gray-600\">Configuration g√©n√©rale de la plateforme</p>\n\n            <!-- Param√®tres g√©n√©raux -->\n            <div class=\"bg-white rounded-lg shadow-lg p-6 mb-8\">\n                <h2 class=\"text-xl font-semibold mb-4\">Param√®tres g√©n√©raux</h2>\n                <form @submit.prevent=\"saveGeneralSettings\">\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-gray-700 mb-1\">Nom de la plateforme</label>\n                            <input v-model=\"settings.platform_name\" class=\"input-field\" required />\n                        </div>\n                        <div>\n                            <label class=\"block text-gray-700 mb-1\">Email de contact</label>\n                            <input v-model=\"settings.contact_email\" class=\"input-field\" required type=\"email\" />\n                        </div>\n                        <div>\n                            <label class=\"block text-gray-700 mb-1\">T√©l√©phone de contact</label>\n                            <input v-model=\"settings.contact_phone\" class=\"input-field\" />\n                        </div>\n                        <div>\n                            <label class=\"block text-gray-700 mb-1\">Fuseau horaire</label>\n                            <input v-model=\"settings.timezone\" class=\"input-field\" />\n                        </div>\n                        <div class=\"md:col-span-2\">\n                            <label class=\"block text-gray-700 mb-1\">Adresse de la soci√©t√©</label>\n                            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n                                <div>\n                                    <label class=\"block text-sm text-gray-600 mb-1\">Rue</label>\n                                    <input v-model=\"settings.company_street\" class=\"input-field\" placeholder=\"Nom de la rue\">\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm text-gray-600 mb-1\">Num√©ro</label>\n                                    <input v-model=\"settings.company_street_number\" class=\"input-field\" placeholder=\"Num√©ro\">\n                                </div>\n                            </div>\n                            <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                                <div>\n                                    <label class=\"block text-sm text-gray-600 mb-1\">Code postal</label>\n                                    <input v-model=\"settings.company_postal_code\" class=\"input-field\" placeholder=\"Code postal\">\n                                </div>\n                                <div>\n                                    <label class=\"block text-sm text-gray-600 mb-1\">Ville</label>\n                                    <input v-model=\"settings.company_city\" class=\"input-field\" placeholder=\"Ville\">\n                                </div>\n                                  <div>\n                                      <label class=\"block text-sm text-gray-600 mb-1\">Pays</label>\n                                      <input v-model=\"settings.company_country\" class=\"input-field\" placeholder=\"France\">\n                                  </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    <div class=\"form-button-group\">\n                        <button type=\"submit\" class=\"btn-primary\" :disabled=\"loading\">\n                            {{ loading ? 'Sauvegarde...' : 'Sauvegarder' }}\n                        </button>\n                    </div>\n                </form>\n            </div>\n\n            <!-- Statistiques syst√®me -->\n            <div class=\"bg-white rounded-lg shadow-lg p-6\">\n                <h2 class=\"text-xl font-semibold mb-4\">Informations syst√®me</h2>\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <div class=\"bg-blue-50 p-4 rounded\">\n                        <div class=\"text-2xl font-bold text-blue-600\">{{ stats.users || 0 }}</div>\n                        <div class=\"text-sm text-gray-600\">Utilisateurs total</div>\n                    </div>\n                    <div class=\"bg-green-50 p-4 rounded\">\n                        <div class=\"text-2xl font-bold text-green-600\">{{ stats.teachers || 0 }}</div>\n                        <div class=\"text-sm text-gray-600\">Enseignants</div>\n                    </div>\n                    <div class=\"bg-orange-50 p-4 rounded\">\n                        <div class=\"text-2xl font-bold text-orange-600\">{{ stats.students || 0 }}</div>\n                        <div class=\"text-sm text-gray-600\">√âtudiants</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script setup>\ndefinePageMeta({\n    layout: 'admin',\n    middleware: 'admin'\n})\n\nconst loading = ref(false)\n\n// Utiliser le composable de param√®tres global\nconst { settings, loadSettings, saveSettings } = useSettings()\n\nconst stats = ref({\n    users: 0,\n    teachers: 0,\n    students: 0\n})\n\n// Charger les statistiques\nconst loadStats = async () => {\n    try {\n        const { $api } = useNuxtApp()\n        const response = await $api.get('/admin/stats')\n        if (response.data.stats) {\n            stats.value = {\n                users: response.data.stats.total_users || 0,\n                teachers: response.data.stats.total_teachers || 0,\n                students: response.data.stats.total_students || 0,\n            }\n        }\n    } catch (error) {\n        console.error('Erreur lors du chargement des statistiques:', error)\n    }\n}\n\n// Sauvegarder les param√®tres g√©n√©raux\nconst saveGeneralSettings = async () => {\n    loading.value = true\n    try {\n        console.log('üîß [SETTINGS] D√©but sauvegarde des param√®tres:', settings.value)\n\n        // Utiliser le composable global pour sauvegarder ET mettre √† jour le header\n        const success = await saveSettings(settings.value)\n\n        if (success) {\n            console.log('‚úÖ [SETTINGS] Param√®tres sauvegard√©s avec succ√®s')\n            alert('Param√®tres sauvegard√©s avec succ√®s ! Le nom de la plateforme est maintenant mis √† jour dans le header.')\n        } else {\n            alert('Erreur lors de la sauvegarde. Consultez la console pour plus de d√©tails.')\n        }\n    } catch (error) {\n        console.error('‚ùå [SETTINGS] Erreur lors de la sauvegarde:', error)\n        alert('Erreur lors de la sauvegarde. Consultez la console pour plus de d√©tails.')\n    } finally {\n        loading.value = false\n    }\n}\n\n// Initialisation au montage du composant\nonMounted(() => {\n    loadSettings()\n    loadStats()\n})\n</script>"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderAttr","_unref","_ssrInterpolate"],"mappings":";;;;;;;;;;;;;;;;;AAKO,MAAM,cAAc,MAAM;AAE7B,QAAM,WAAW,IAAI;AAAA,IACjB,eAAe;AAAA,IACf,eAAe;AAAA,IACf,eAAe;AAAA,IACf,iBAAiB;AAAA,IACjB,UAAU;AAAA,IACV,UAAU;AAAA,IACV,aAAa;AAAA,EAAA,CAChB;AAGD,QAAM,eAAe,YAAY;AAC7B,QAAI;AACA,YAAM,EAAE,KAAA,IAAS,WAAA;AACjB,YAAM,WAAW,MAAM,KAAK,IAAI,yBAAyB;AAEzD,UAAI,SAAS,MAAM;AACf,iBAAS,QAAQ,EAAE,GAAG,SAAS,OAAO,GAAG,SAAS,KAAA;AAAA,MACtD;AAAA,IACJ,SAAS,OAAO;AACZ,cAAQ,KAAK,yCAAyC,KAAK;AAAA,IAE/D;AAAA,EACJ;AAGA,QAAM,eAAe,OAAO,gBAAgD;;AACxE,QAAI;AACA,YAAM,EAAE,KAAA,IAAS,WAAA;AACjB,YAAM,WAAW,MAAM,KAAK,IAAI,2BAA2B,WAAW;AAEtE,WAAI,cAAS,SAAT,mBAAe,SAAS;AACxB,iBAAS,QAAQ,EAAE,GAAG,SAAS,OAAO,GAAG,YAAA;AACzC,gBAAQ,IAAI,6BAA6B,SAAS,KAAK,OAAO;AAC9D,eAAO;AAAA,MACX;AACA,aAAO;AAAA,IACX,SAAS,OAAO;AACZ,cAAQ,MAAM,mCAAmC,KAAK;AACtD,aAAO;AAAA,IACX;AAAA,EACJ;AAEA,SAAO;AAAA,IACH;AAAA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAER;;;;;ACsCA,UAAM,UAAU,IAAI,KAAK;AAGzB,UAAM,EAAE,SAAqC,IAAI,YAAW;AAE5D,UAAM,QAAQ,IAAI;AAAA,MACd,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACd,CAAC;;mBArGQA,eAAAC,WAAA,EAAA,OAAM,0BAAyB,GAAA,MAAA,CAAA,2cAYIC,cAAA,SAAAC,MAAA,QAAA,EAAS,aAAa,mHAItBD,cAAA,SAAAC,MAAA,QAAA,EAAS,aAAa,oIAItBD,cAAA,SAAAC,MAAA,QAAA,EAAS,aAAa,wGAItBD,cAAA,SAAAC,MAAA,QAAA,EAAS,QAAQ,6PAOTD,cAAA,SAAAC,MAAA,QAAA,EAAS,cAAc,oIAIvBD,cAAA,SAAAC,MAAA,QAAA,EAAS,qBAAqB,2LAM9BD,cAAA,SAAAC,MAAA,QAAA,EAAS,mBAAmB,iIAI5BD,cAAA,SAAAC,MAAA,QAAA,EAAS,YAAY,0HAInBD,cAAA,SAAAC,MAAA,QAAA,EAAS,eAAe,oKAQDA,MAAA,OAAA,CAAO,IAAA,cAAA,qBACrDA,MAAA,OAAA,IAAO,kBAAA,aAAA,oRAWmCC,eAAAD,MAAA,KAAA,EAAM,SAAK,CAAA,+JAIVC,eAAAD,MAAA,KAAA,EAAM,YAAQ,CAAA,0JAIbC,eAAAD,MAAA,KAAA,EAAM,YAAQ,CAAA;;;;;;;;;;"}