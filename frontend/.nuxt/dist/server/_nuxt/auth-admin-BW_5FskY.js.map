{"version":3,"file":"auth-admin-BW_5FskY.js","sources":["../../../../middleware/auth-admin.ts"],"sourcesContent":["export default defineNuxtRouteMiddleware(async (to) => {\n    const authStore = useAuthStore()\n\n    // Si pas de token, rediriger vers login\n    if (!authStore.token) {\n        return navigateTo('/login')\n    }\n\n    // Vérifier que l'utilisateur est toujours valide côté serveur\n    try {\n        await authStore.fetchUser()\n\n        // Vérifier que l'utilisateur est admin (avec vérification robuste)\n        if (!authStore.user || authStore.user.role !== 'admin') {\n            console.error('Utilisateur non-admin détecté:', authStore.user?.role)\n            throw createError({\n                statusCode: 403,\n                statusMessage: 'Accès refusé - Droits administrateur requis'\n            })\n        }\n    } catch (error: any) {\n        // Token invalide ou erreur serveur\n        console.error('Erreur vérification admin:', error)\n\n        // Si erreur 401, token expiré\n        if (error.response?.status === 401) {\n            await authStore.logout()\n            return navigateTo('/login?expired=true')\n        }\n\n        // Autre erreur, accès refusé\n        throw createError({\n            statusCode: 403,\n            statusMessage: 'Accès refusé - Droits administrateur requis'\n        })\n    }\n})\n"],"names":["__executeAsync"],"mappings":";;;;;;;;;;;;;;;;;AACI,MAAA,sCAA+B,OAAA,OAAA;;AAAA,MAAA,QAAA;AAG/B,oBAAe,aAAO;AAClB,MAAA,CAAA,iBAAkB;AACtB,WAAA,WAAA,QAAA;AAAA,EAGA;AACI,MAAA;AAGA;AAAA,IAAA,CAAI,QAAC,SAAU,IAAAA,aAAkB,gBAAc,UAAS,CAAA,GAAA,MAAA,QAAA,UAAA;AAAA;AACpD,QAAA,CAAA,UAAQ,QAAM,UAAA,KAAA,SAAA,SAAkC;AAChD,cAAM,MAAA,mCAAY,eAAA,SAAA,mBAAA,IAAA;AAAA,YACd,YAAY;AAAA,QACZ,YAAA;AAAA,QACH,eAAA;AAAA,MAAA,CACL;AAAA;EAGA,SAAA,OAAc;AAGd,YAAI,MAAM,8BAA0B,KAAA;AAChC;AACA,MAAA,CAAA,iBAAkB,IAAAA,aAAA,MAAqB,UAAA,OAAA,CAAA,GAAA,MAAA,QAAA,UAAA;AAC3C,aAAA,WAAA,qBAAA;AAAA,IAGA;AAAkB,UACd,YAAY;AAAA,MACZ,YAAA;AAAA,MACH,eAAA;AAAA,IAAA,CACL;AAAA,EACJ;;"}