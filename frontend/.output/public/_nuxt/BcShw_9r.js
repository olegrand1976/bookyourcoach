import{_ as q}from"./CYBK13Vr.js";import{e as A,j as C,k as I,l as R,r as _,f as U,c as d,a as e,t as a,i as s,d as E,b as F,w as S,m as T,p as N,q as x,v as V,s as j,F as B,x as L,o as c,n as y,y as z}from"./B73CQWOX.js";import{u as D}from"./C4hk_EZT.js";const $={class:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},O={class:"max-w-md w-full space-y-8"},G={class:"mt-6 text-center text-3xl font-extrabold text-gray-900"},H={class:"mt-2 text-center text-sm text-gray-600"},J={class:"rounded-md shadow-sm -space-y-px"},K={for:"email",class:"sr-only"},Q=["placeholder"],W={for:"password",class:"sr-only"},X=["placeholder"],Y={class:"flex items-center justify-between"},Z={class:"flex items-center"},ee={for:"remember-me",class:"ml-2 block text-sm text-gray-900"},se={class:"text-sm"},te={href:"#",class:"font-medium text-primary-600 hover:text-primary-500"},re=["disabled"],oe={key:0},ae={key:1},ie={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-md p-4"},ne={class:"text-sm text-yellow-700"},le={class:"list-disc list-inside"},de={key:1,class:"bg-red-50 border border-red-200 rounded-md p-4"},ce={class:"text-sm text-red-600"},he={__name:"login",setup(ue){const p=A(),b=D();C();const{t:r}=I(),t=R({email:"",password:"",remember:!1}),m=_(!1),f=_(""),h=_([]),M=()=>{const n=[];return t.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||n.push("Format email invalide"):n.push("Email requis"),t.password?t.password.length<6&&n.push("Mot de passe trop court (minimum 6 caractères)"):n.push("Mot de passe requis"),n},P=async()=>{var l,g,o,v,w,k;m.value=!0,f.value="",h.value=[];const n=M();if(n.length>0){h.value=n,m.value=!1;return}try{await p.login({email:t.email,password:t.password}),b.success("Connexion réussie"),p.isAdmin?await y("/admin"):p.isTeacher?await y("/teacher"):await y("/dashboard")}catch(i){console.error("Erreur de connexion complète:",i),console.error("Response data:",(l=i.response)==null?void 0:l.data),console.error("Response status:",(g=i.response)==null?void 0:g.status),console.error("URL de base API:",z().public.apiBase);let u="Une erreur est survenue";(v=(o=i.response)==null?void 0:o.data)!=null&&v.message?u=i.response.data.message:i.code==="ECONNREFUSED"||i.message.includes("Network Error")?u="Impossible de se connecter au serveur. Vérifiez que l'API est accessible.":((w=i.response)==null?void 0:w.status)===422?u="Informations de connexion invalides":((k=i.response)==null?void 0:k.status)===401?u="Email ou mot de passe incorrect":u=`Erreur: ${i.message||"Erreur inconnue"}`,f.value=u,b.error("Erreur de connexion")}finally{m.value=!1}};return U(()=>{p.isAuthenticated&&y("/dashboard")}),(n,l)=>{const g=q;return c(),d("div",$,[e("div",O,[e("div",null,[e("h2",G,a(s(r)("loginPage.title")),1),e("p",H,[E(a(s(r)("loginPage.or"))+" ",1),F(g,{to:"/register",class:"font-medium text-primary-600 hover:text-primary-500"},{default:S(()=>[E(a(s(r)("loginPage.createAccount")),1)]),_:1})])]),e("form",{class:"mt-8 space-y-6",onSubmit:T(P,["prevent"])},[e("div",J,[e("div",null,[e("label",K,a(s(r)("auth.email")),1),x(e("input",{id:"email","onUpdate:modelValue":l[0]||(l[0]=o=>s(t).email=o),name:"email",type:"email",autocomplete:"email",required:"",class:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm",placeholder:s(r)("auth.email")},null,8,Q),[[V,s(t).email]])]),e("div",null,[e("label",W,a(s(r)("auth.password")),1),x(e("input",{id:"password","onUpdate:modelValue":l[1]||(l[1]=o=>s(t).password=o),name:"password",type:"password",autocomplete:"current-password",required:"",class:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm",placeholder:s(r)("auth.password")},null,8,X),[[V,s(t).password]])])]),e("div",Y,[e("div",Z,[x(e("input",{id:"remember-me","onUpdate:modelValue":l[2]||(l[2]=o=>s(t).remember=o),name:"remember-me",type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[j,s(t).remember]]),e("label",ee,a(s(r)("auth.rememberMe")),1)]),e("div",se,[e("a",te,a(s(r)("auth.forgotPassword")),1)])]),e("div",null,[e("button",{type:"submit",disabled:s(m),class:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50"},[s(m)?(c(),d("span",oe,a(s(r)("loginPage.loggingIn")),1)):(c(),d("span",ae,a(s(r)("auth.login")),1))],8,re)]),s(h).length>0?(c(),d("div",ie,[e("div",ne,[e("ul",le,[(c(!0),d(B,null,L(s(h),o=>(c(),d("li",{key:o},a(o),1))),128))])])])):N("",!0),s(f)?(c(),d("div",de,[e("div",ce,a(s(f)),1)])):N("",!0)],32)])])}}};export{he as default};
