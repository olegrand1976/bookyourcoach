import{_ as q}from"./CufzsiaN.js";import{e as A,j as C,k as I,r as y,f as R,c as d,a as e,t as a,i as s,d as E,b as U,w as F,l as S,m as N,p as x,v as V,q as T,F as j,s as B,o as c,n as _,x as L}from"./DS9r2nwn.js";import{u as z}from"./C4hk_EZT.js";const D={class:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},$={class:"max-w-md w-full space-y-8"},O={class:"mt-6 text-center text-3xl font-extrabold text-gray-900"},G={class:"mt-2 text-center text-sm text-gray-600"},H={class:"rounded-md shadow-sm -space-y-px"},J={for:"email",class:"sr-only"},K=["placeholder"],Q={for:"password",class:"sr-only"},W=["placeholder"],X={class:"flex items-center justify-between"},Y={class:"flex items-center"},Z={for:"remember-me",class:"ml-2 block text-sm text-gray-900"},ee={class:"text-sm"},se={href:"#",class:"font-medium text-primary-600 hover:text-primary-500"},te=["disabled"],re={key:0},oe={key:1},ae={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-md p-4"},ie={class:"text-sm text-yellow-700"},ne={class:"list-disc list-inside"},le={key:1,class:"bg-red-50 border border-red-200 rounded-md p-4"},de={class:"text-sm text-red-600"},fe={__name:"login",setup(ce){const p=A(),b=z();C();const{t:r}=useI18n(),t=I({email:"",password:"",remember:!1}),m=y(!1),f=y(""),h=y([]),M=()=>{const n=[];return t.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||n.push("Format email invalide"):n.push("Email requis"),t.password?t.password.length<6&&n.push("Mot de passe trop court (minimum 6 caractères)"):n.push("Mot de passe requis"),n},P=async()=>{var l,g,o,v,w,k;m.value=!0,f.value="",h.value=[];const n=M();if(n.length>0){h.value=n,m.value=!1;return}try{await p.login({email:t.email,password:t.password}),b.success("Connexion réussie"),p.isAdmin?await _("/admin"):p.isTeacher?await _("/teacher"):await _("/dashboard")}catch(i){console.error("Erreur de connexion complète:",i),console.error("Response data:",(l=i.response)==null?void 0:l.data),console.error("Response status:",(g=i.response)==null?void 0:g.status),console.error("URL de base API:",L().public.apiBase);let u="Une erreur est survenue";(v=(o=i.response)==null?void 0:o.data)!=null&&v.message?u=i.response.data.message:i.code==="ECONNREFUSED"||i.message.includes("Network Error")?u="Impossible de se connecter au serveur. Vérifiez que l'API est accessible.":((w=i.response)==null?void 0:w.status)===422?u="Informations de connexion invalides":((k=i.response)==null?void 0:k.status)===401?u="Email ou mot de passe incorrect":u=`Erreur: ${i.message||"Erreur inconnue"}`,f.value=u,b.error("Erreur de connexion")}finally{m.value=!1}};return R(()=>{p.isAuthenticated&&_("/dashboard")}),(n,l)=>{const g=q;return c(),d("div",D,[e("div",$,[e("div",null,[e("h2",O,a(s(r)("loginPage.title")),1),e("p",G,[E(a(s(r)("loginPage.or"))+" ",1),U(g,{to:"/register",class:"font-medium text-primary-600 hover:text-primary-500"},{default:F(()=>[E(a(s(r)("loginPage.createAccount")),1)]),_:1})])]),e("form",{class:"mt-8 space-y-6",onSubmit:S(P,["prevent"])},[e("div",H,[e("div",null,[e("label",J,a(s(r)("auth.email")),1),x(e("input",{id:"email","onUpdate:modelValue":l[0]||(l[0]=o=>s(t).email=o),name:"email",type:"email",autocomplete:"email",required:"",class:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm",placeholder:s(r)("auth.email")},null,8,K),[[V,s(t).email]])]),e("div",null,[e("label",Q,a(s(r)("auth.password")),1),x(e("input",{id:"password","onUpdate:modelValue":l[1]||(l[1]=o=>s(t).password=o),name:"password",type:"password",autocomplete:"current-password",required:"",class:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm",placeholder:s(r)("auth.password")},null,8,W),[[V,s(t).password]])])]),e("div",X,[e("div",Y,[x(e("input",{id:"remember-me","onUpdate:modelValue":l[2]||(l[2]=o=>s(t).remember=o),name:"remember-me",type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[T,s(t).remember]]),e("label",Z,a(s(r)("auth.rememberMe")),1)]),e("div",ee,[e("a",se,a(s(r)("auth.forgotPassword")),1)])]),e("div",null,[e("button",{type:"submit",disabled:s(m),class:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50"},[s(m)?(c(),d("span",re,a(s(r)("loginPage.loggingIn")),1)):(c(),d("span",oe,a(s(r)("auth.login")),1))],8,te)]),s(h).length>0?(c(),d("div",ae,[e("div",ie,[e("ul",ne,[(c(!0),d(j,null,B(s(h),o=>(c(),d("li",{key:o},a(o),1))),128))])])])):N("",!0),s(f)?(c(),d("div",le,[e("div",de,a(s(f)),1)])):N("",!0)],32)])])}}};export{fe as default};
