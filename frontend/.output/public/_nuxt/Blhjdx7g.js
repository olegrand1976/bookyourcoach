import{f as k,B as w,h as $,x as R,c as d,a as t,d as l,t as o,m as i,H as T,F as C,p as E,o as c}from"./CplJ7MsP.js";const I={class:"container mx-auto p-8"},L={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"},O={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},P={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},B={class:"bg-black text-green-400 p-4 rounded font-mono text-sm max-h-96 overflow-y-auto"},J={__name:"debug-auth",setup(D){const s=k(),{$api:f}=w(),u=$([]);function n(r){const e=new Date;u.value.push({time:e.toLocaleTimeString(),message:r})}function h(){u.value=[]}async function x(){var r;n("🔄 Tentative de connexion...");try{await s.login({email:"admin.secours@activibe.com",password:"secours123"}),n(`✅ Connexion réussie - Role: ${(r=s.user)==null?void 0:r.role}`)}catch(e){n(`❌ Erreur de connexion: ${e.message}`)}}async function A(){var r;n("🔄 Rafraîchissement utilisateur...");try{await s.fetchUser(),n(`✅ Utilisateur rafraîchi - Role: ${(r=s.user)==null?void 0:r.role}`)}catch(e){n(`❌ Erreur rafraîchissement: ${e.message}`)}}function v(){n("📦 Vérification localStorage...");{const r=localStorage.getItem("auth-token"),e=localStorage.getItem("user-data");if(n(`🔑 Token: ${r?r.substring(0,30)+"...":"ABSENT"}`),e)try{const a=JSON.parse(e);n(`👤 User data: ${a.name} - Role: ${a.role}`)}catch(a){n(`❌ Erreur parsing user data: ${a.message}`)}else n("📦 Pas de données utilisateur dans localStorage")}}async function y(){n("🎯 Test API direct...");try{const r=await f.get("/auth/user"),e=r.data.user||r.data;n(`📥 API Response - Role: ${e.role}, Name: ${e.name}`)}catch(r){n(`❌ Erreur API: ${r.message}`)}}async function S(){var r,e;n("🔄 Simulation rafraîchissement de page..."),n("📤 État avant: "+JSON.stringify({role:(r=s.user)==null?void 0:r.role,isAuthenticated:s.isAuthenticated,isAdmin:s.isAdmin})),await s.initializeAuth(),n("📥 État après: "+JSON.stringify({role:(e=s.user)==null?void 0:e.role,isAuthenticated:s.isAuthenticated,isAdmin:s.isAdmin}))}return R(()=>{var r,e;n("🚀 Page de debug chargée"),n("📊 État initial: "+JSON.stringify({user:((r=s.user)==null?void 0:r.email)||"Non connecté",role:((e=s.user)==null?void 0:e.role)||"N/A",isAuthenticated:s.isAuthenticated,isAdmin:s.isAdmin}))}),(r,e)=>{var a,g,m,b;return c(),d("div",I,[e[9]||(e[9]=t("h1",{class:"text-3xl font-bold mb-6"},"🔍 Debug Authentification",-1)),t("div",L,[e[6]||(e[6]=t("h2",{class:"text-xl font-semibold mb-3"},"📊 État actuel",-1)),t("div",O,[t("div",null,[e[0]||(e[0]=t("strong",null,"Utilisateur:",-1)),l(" "+o(((a=i(s).user)==null?void 0:a.name)||"Non connecté"),1)]),t("div",null,[e[1]||(e[1]=t("strong",null,"Email:",-1)),l(" "+o(((g=i(s).user)==null?void 0:g.email)||"N/A"),1)]),t("div",null,[e[2]||(e[2]=t("strong",null,"Rôle:",-1)),t("span",{class:T(((m=i(s).user)==null?void 0:m.role)==="admin"?"text-green-600 font-bold":"text-red-600 font-bold")},o(((b=i(s).user)==null?void 0:b.role)||"N/A"),3)]),t("div",null,[e[3]||(e[3]=t("strong",null,"Authentifié:",-1)),l(" "+o(i(s).isAuthenticated?"✅ Oui":"❌ Non"),1)]),t("div",null,[e[4]||(e[4]=t("strong",null,"Token présent:",-1)),l(" "+o(i(s).token?"✅ Oui":"❌ Non"),1)]),t("div",null,[e[5]||(e[5]=t("strong",null,"Admin:",-1)),l(" "+o(i(s).isAdmin?"✅ Oui":"❌ Non"),1)])])]),t("div",{class:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6"},[e[7]||(e[7]=t("h2",{class:"text-xl font-semibold mb-3"},"🧪 Tests",-1)),t("div",{class:"space-y-2"},[t("button",{onClick:x,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mr-2"}," 🔑 Se connecter "),t("button",{onClick:A,class:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 mr-2"}," 🔄 Rafraîchir utilisateur "),t("button",{onClick:v,class:"bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 mr-2"}," 📦 Vérifier localStorage "),t("button",{onClick:y,class:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 mr-2"}," 🎯 Test API direct "),t("button",{onClick:S,class:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"}," 🔄 Simuler rafraîchissement ")])]),t("div",P,[e[8]||(e[8]=t("h2",{class:"text-xl font-semibold mb-3"},"📝 Logs de debug",-1)),t("div",B,[(c(!0),d(C,null,E(i(u),(p,N)=>(c(),d("div",{key:N,class:"mb-1"}," ["+o(p.time)+"] "+o(p.message),1))),128))]),t("button",{onClick:h,class:"mt-2 bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm"}," 🗑️ Effacer logs ")])])}}};export{J as default};
