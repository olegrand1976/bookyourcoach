import{_ as w}from"./BqVblDrL.js";import{f as k,h as _,r as V,x as S,y as A,c,a as o,d,j as E,k as f,l as a,v as u,m as s,b as y,z as P,e as U,A as C,B as x,o as m}from"./b2as_OcS.js";import{u as N}from"./C4hk_EZT.js";const G={class:"min-h-screen bg-gray-50"},z={class:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8"},D={class:"bg-white shadow-lg rounded-lg border border-gray-200"},M={class:"border-b border-gray-200 pb-6"},T={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},I={key:0,class:"border-b border-gray-200 pb-6"},B={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},j={key:1,class:"border-b border-gray-200 pb-6"},q={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},$={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},F={key:2,class:"border-b border-gray-200 pb-6"},H={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},O={class:"md:col-span-2"},R={class:"flex justify-end space-x-4 pt-6"},W=["disabled"],K=["disabled"],L={key:0,class:"mr-2"},ee={__name:"profile",setup(Q){const l=k(),b=N(),p=_(!1),t=V({name:"",email:"",phone:"",birth_date:"",specialties:"",experience_years:0,certifications:"",hourly_rate:0,riding_level:"",course_preferences:"",emergency_contact:""}),g=async()=>{if(console.log("loadProfileData called, user:",l.user),!l.user)if(console.log("No user found in authStore, trying to fetch from API"),C("auth-token").value)try{const{$api:e}=x(),i=await e.get("/auth/user");l.user=i.data,l.isAuthenticated=!0,console.log("User fetched from API:",i.data)}catch(e){console.error("Erreur lors de la r√©cup√©ration de l'utilisateur:",e);return}else return;console.log("Preloading user data:",l.user.name,l.user.email),t.name=l.user.name||"",t.email=l.user.email||"";try{const{$api:n}=x(),e=await n.get("/profile-test");if(e.data.profile){const i=e.data.profile;if(t.phone=i.phone||"",i.date_of_birth){const r=new Date(i.date_of_birth);t.birth_date=r.toISOString().split("T")[0]}else t.birth_date="";if(l.isTeacher&&e.data.teacher){const r=e.data.teacher;t.specialties=r.specialties||"",t.experience_years=r.experience_years||0,t.certifications=r.certifications||"",t.hourly_rate=r.hourly_rate||0}if(l.isStudent&&e.data.student){const r=e.data.student;t.riding_level=r.level||"",t.course_preferences=r.course_preferences||"",t.emergency_contact=r.emergency_contact||""}}}catch(n){console.error("Erreur lors du chargement du profil:",n),b.error("Erreur lors du chargement du profil")}};S(async()=>{console.log("onMounted - authStore.user:",l.user),console.log("onMounted - authStore.isAuthenticated:",l.isAuthenticated),await g()}),A(()=>l.user,(n,e)=>{console.log("Watch triggered - newUser:",n,"oldUser:",e),n&&n!==e&&g()},{immediate:!0});const v=async()=>{p.value=!0;try{const{$api:n}=x();await n.put("/profile-test",t),b.success("Profil mis √† jour avec succ√®s"),l.user.name=t.name,l.user.email=t.email}catch(n){console.error("Erreur lors de la mise √† jour:",n),b.error("Erreur lors de la mise √† jour du profil")}finally{p.value=!1}},h=()=>{l.user&&(t.name=l.user.name||"",t.email=l.user.email||"",g())};return(n,e)=>{const i=w;return m(),c("div",G,[o("div",z,[e[30]||(e[30]=o("div",{class:"mb-8"},[o("h1",{class:"text-3xl font-bold text-gray-900 flex items-center"},[o("span",{class:"text-4xl mr-3"},"üë§"),d(" Mon Profil ")]),o("p",{class:"mt-2 text-gray-600"},"G√©rez vos informations personnelles et pr√©f√©rences")],-1)),o("div",D,[o("form",{onSubmit:E(v,["prevent"]),class:"space-y-6 p-6"},[o("div",M,[e[15]||(e[15]=o("h2",{class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},[o("span",{class:"text-xl mr-2"},"üèá"),d(" Informations personnelles ")],-1)),o("div",T,[o("div",null,[e[11]||(e[11]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom complet",-1)),a(o("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>s(t).name=r),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Votre nom complet",required:""},null,512),[[u,s(t).name]])]),o("div",null,[e[12]||(e[12]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email",-1)),a(o("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>s(t).email=r),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"votre@email.com",required:""},null,512),[[u,s(t).email]])]),o("div",null,[e[13]||(e[13]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"T√©l√©phone",-1)),a(o("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s(t).phone=r),type:"tel",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+33 6 12 34 56 78"},null,512),[[u,s(t).phone]])]),o("div",null,[e[14]||(e[14]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date de naissance",-1)),a(o("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s(t).birth_date=r),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[u,s(t).birth_date]])])])]),s(l).isAdmin?(m(),c("div",I,[o("h2",B,[y(i,{icon:"trophy",class:"mr-2 text-primary-600",size:20}),e[16]||(e[16]=d(" Administration ",-1))]),e[17]||(e[17]=o("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[o("p",{class:"text-blue-800"},[o("strong",null,"R√¥le :"),d(" Administrateur syst√®me ")]),o("p",{class:"text-blue-700 text-sm mt-1"}," Acc√®s complet aux fonctionnalit√©s de gestion de la plateforme ")],-1))])):f("",!0),s(l).isTeacher?(m(),c("div",j,[o("h2",q,[y(i,{icon:"saddle",class:"mr-2 text-primary-600",size:20}),e[18]||(e[18]=d(" Informations d'enseignant ",-1))]),o("div",$,[o("div",null,[e[19]||(e[19]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Sp√©cialit√©s",-1)),a(o("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>s(t).specialties=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",placeholder:"Dressage, saut d'obstacles, √©quitation western..."},null,512),[[u,s(t).specialties]])]),o("div",null,[e[20]||(e[20]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Exp√©rience (ann√©es)",-1)),a(o("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s(t).experience_years=r),type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",placeholder:"10"},null,512),[[u,s(t).experience_years]])]),o("div",null,[e[21]||(e[21]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Certifications",-1)),a(o("textarea",{"onUpdate:modelValue":e[6]||(e[6]=r=>s(t).certifications=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"BPJEPS, Galop 7, FFE..."},null,512),[[u,s(t).certifications]])]),o("div",null,[e[22]||(e[22]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tarif horaire (‚Ç¨)",-1)),a(o("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>s(t).hourly_rate=r),type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",step:"5",placeholder:"45"},null,512),[[u,s(t).hourly_rate]])])])])):f("",!0),s(l).isStudent?(m(),c("div",F,[o("h2",H,[y(i,{icon:"horseshoe",class:"mr-2 text-primary-600",size:20}),e[23]||(e[23]=d(" Informations d'√©l√®ve ",-1))]),o("div",J,[o("div",null,[e[25]||(e[25]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Niveau √©questre",-1)),a(o("select",{"onUpdate:modelValue":e[8]||(e[8]=r=>s(t).riding_level=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[24]||(e[24]=[U('<option value="">S√©lectionnez votre niveau</option><option value="debutant">D√©butant</option><option value="galop1">Galop 1</option><option value="galop2">Galop 2</option><option value="galop3">Galop 3</option><option value="galop4">Galop 4</option><option value="galop5">Galop 5</option><option value="galop6">Galop 6</option><option value="galop7">Galop 7</option><option value="expert">Expert</option>',10)]),512),[[P,s(t).riding_level]])]),o("div",null,[e[26]||(e[26]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pr√©f√©rences de cours",-1)),a(o("textarea",{"onUpdate:modelValue":e[9]||(e[9]=r=>s(t).course_preferences=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"Dressage, saut, balade..."},null,512),[[u,s(t).course_preferences]])]),o("div",O,[e[27]||(e[27]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Contact d'urgence",-1)),a(o("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>s(t).emergency_contact=r),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nom et t√©l√©phone du contact d'urgence"},null,512),[[u,s(t).emergency_contact]])])])])):f("",!0),o("div",R,[o("button",{type:"button",onClick:h,class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:s(p)}," Annuler ",8,W),o("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent flex items-center",disabled:s(p)},[s(p)?(m(),c("span",L,e[28]||(e[28]=[o("svg",{class:"animate-spin h-4 w-4",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):f("",!0),e[29]||(e[29]=d(" Sauvegarder ",-1))],8,K)])],32)])])])}}};export{ee as default};
