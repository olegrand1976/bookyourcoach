import{_ as k}from"./CTIhksb8.js";import{e as _,r as V,l as w,g as S,z as A,c as m,a as t,b as c,d as u,m as E,p as b,q as n,v as d,i as l,A as C,B as P,C as U,D as y,o as f}from"./D0Y81rF_.js";import{u as z}from"./C4hk_EZT.js";import"./DlAUqK2U.js";const N={class:"min-h-screen bg-gray-50"},D={class:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8"},G={class:"mb-8"},M={class:"text-3xl font-bold text-gray-900 flex items-center"},T={class:"bg-white shadow-lg rounded-lg"},I={class:"border-b border-gray-200 pb-6"},q={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},B={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},j={key:0,class:"border-b border-gray-200 pb-6"},F={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},$={key:1,class:"border-b border-gray-200 pb-6"},H={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},O={key:2,class:"border-b border-gray-200 pb-6"},R={class:"text-lg font-semibold text-gray-900 mb-4 flex items-center"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},K={class:"md:col-span-2"},L={class:"flex justify-end space-x-4 pt-6"},Q=["disabled"],X=["disabled"],Y={key:0,class:"mr-2"},le={__name:"profile",setup(Z){const r=_(),g=z(),p=V(!1),o=w({name:"",email:"",phone:"",birth_date:"",specialties:"",experience_years:0,certifications:"",hourly_rate:0,riding_level:"",course_preferences:"",emergency_contact:""}),x=async()=>{if(console.log("loadProfileData called, user:",r.user),!r.user)if(console.log("No user found in authStore, trying to fetch from API"),U("auth-token").value)try{const{$api:e}=y(),a=await e.get("/auth/user");r.user=a.data,r.isAuthenticated=!0,console.log("User fetched from API:",a.data)}catch(e){console.error("Erreur lors de la récupération de l'utilisateur:",e);return}else return;console.log("Preloading user data:",r.user.name,r.user.email),o.name=r.user.name||"",o.email=r.user.email||"";try{const{$api:i}=y(),e=await i.get("/profile");if(e.data.profile){const a=e.data.profile;if(o.phone=a.phone||"",a.date_of_birth){const s=new Date(a.date_of_birth);o.birth_date=s.toISOString().split("T")[0]}else o.birth_date="";if(r.isTeacher&&e.data.teacher){const s=e.data.teacher;o.specialties=s.specialties||"",o.experience_years=s.experience_years||0,o.certifications=s.certifications||"",o.hourly_rate=s.hourly_rate||0}if(r.isStudent&&e.data.student){const s=e.data.student;o.riding_level=s.level||"",o.course_preferences=s.course_preferences||"",o.emergency_contact=s.emergency_contact||""}}}catch(i){console.error("Erreur lors du chargement du profil:",i),g.error("Erreur lors du chargement du profil")}};S(async()=>{console.log("onMounted - authStore.user:",r.user),console.log("onMounted - authStore.isAuthenticated:",r.isAuthenticated),await x()}),A(()=>r.user,(i,e)=>{console.log("Watch triggered - newUser:",i,"oldUser:",e),i&&i!==e&&x()},{immediate:!0});const v=async()=>{p.value=!0;try{const{$api:i}=y();await i.put("/profile",o),g.success("Profil mis à jour avec succès"),r.user.name=o.name,r.user.email=o.email}catch(i){console.error("Erreur lors de la mise à jour:",i),g.error("Erreur lors de la mise à jour du profil")}finally{p.value=!1}},h=()=>{r.user&&(o.name=r.user.name||"",o.email=r.user.email||"",x())};return(i,e)=>{const a=k;return f(),m("div",N,[t("div",D,[t("div",G,[t("h1",M,[c(a,{icon:"horse",class:"mr-3 text-primary-600",size:32}),e[11]||(e[11]=u(" Mon Profil ",-1))]),e[12]||(e[12]=t("p",{class:"mt-2 text-gray-600"},"Gérez vos informations personnelles et préférences",-1))]),t("div",T,[t("form",{onSubmit:E(v,["prevent"]),class:"space-y-6 p-6"},[t("div",I,[t("h2",q,[c(a,{icon:"helmet",class:"mr-2 text-primary-600",size:20}),e[13]||(e[13]=u(" Informations personnelles ",-1))]),t("div",B,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nom complet",-1)),n(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l(o).name=s),type:"text",class:"input-field",placeholder:"Votre nom complet",required:""},null,512),[[d,l(o).name]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email",-1)),n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l(o).email=s),type:"email",class:"input-field",placeholder:"votre@email.com",required:""},null,512),[[d,l(o).email]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Téléphone",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l(o).phone=s),type:"tel",class:"input-field",placeholder:"+33 6 12 34 56 78"},null,512),[[d,l(o).phone]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date de naissance",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l(o).birth_date=s),type:"date",class:"input-field"},null,512),[[d,l(o).birth_date]])])])]),l(r).isAdmin?(f(),m("div",j,[t("h2",F,[c(a,{icon:"trophy",class:"mr-2 text-primary-600",size:20}),e[18]||(e[18]=u(" Administration ",-1))]),e[19]||(e[19]=t("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[t("p",{class:"text-blue-800"},[t("strong",null,"Rôle :"),u(" Administrateur système ")]),t("p",{class:"text-blue-700 text-sm mt-1"}," Accès complet aux fonctionnalités de gestion de la plateforme ")],-1))])):b("",!0),l(r).isTeacher?(f(),m("div",$,[t("h2",H,[c(a,{icon:"saddle",class:"mr-2 text-primary-600",size:20}),e[20]||(e[20]=u(" Informations d'enseignant ",-1))]),t("div",J,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Spécialités",-1)),n(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>l(o).specialties=s),class:"input-field",rows:"3",placeholder:"Dressage, saut d'obstacles, équitation western..."},null,512),[[d,l(o).specialties]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Expérience (années)",-1)),n(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l(o).experience_years=s),type:"number",class:"input-field",min:"0",placeholder:"10"},null,512),[[d,l(o).experience_years]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Certifications",-1)),n(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>l(o).certifications=s),class:"input-field",rows:"2",placeholder:"BPJEPS, Galop 7, FFE..."},null,512),[[d,l(o).certifications]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tarif horaire (€)",-1)),n(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l(o).hourly_rate=s),type:"number",class:"input-field",min:"0",step:"5",placeholder:"45"},null,512),[[d,l(o).hourly_rate]])])])])):b("",!0),l(r).isStudent?(f(),m("div",O,[t("h2",R,[c(a,{icon:"horseshoe",class:"mr-2 text-primary-600",size:20}),e[25]||(e[25]=u(" Informations d'élève ",-1))]),t("div",W,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Niveau équestre",-1)),n(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>l(o).riding_level=s),class:"input-field"},e[26]||(e[26]=[P('<option value="">Sélectionnez votre niveau</option><option value="debutant">Débutant</option><option value="galop1">Galop 1</option><option value="galop2">Galop 2</option><option value="galop3">Galop 3</option><option value="galop4">Galop 4</option><option value="galop5">Galop 5</option><option value="galop6">Galop 6</option><option value="galop7">Galop 7</option><option value="expert">Expert</option>',10)]),512),[[C,l(o).riding_level]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Préférences de cours",-1)),n(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>l(o).course_preferences=s),class:"input-field",rows:"2",placeholder:"Dressage, saut, balade..."},null,512),[[d,l(o).course_preferences]])]),t("div",K,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Contact d'urgence",-1)),n(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l(o).emergency_contact=s),type:"text",class:"input-field",placeholder:"Nom et téléphone du contact d'urgence"},null,512),[[d,l(o).emergency_contact]])])])])):b("",!0),t("div",L,[t("button",{type:"button",onClick:h,class:"btn-secondary",disabled:l(p)}," Annuler ",8,Q),t("button",{type:"submit",class:"btn-primary flex items-center",disabled:l(p)},[l(p)?(f(),m("span",Y,e[30]||(e[30]=[t("svg",{class:"animate-spin h-4 w-4",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):b("",!0),e[31]||(e[31]=u(" Sauvegarder ",-1))],8,X)])],32)])])])}}};export{le as default};
