import{_ as I}from"./RdCLEfon.js";import{r as u,h as T,y as B,g as G,c,a as e,m as E,b as V,d as b,p as g,v as w,z as A,t as r,F as S,s as R,l as H,C as _,o as m,H as k}from"./DS9r2nwn.js";import"./DlAUqK2U.js";const J={class:"min-h-screen bg-gray-50"},K={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},O={class:"mb-8"},Q={class:"flex items-center justify-between"},W={class:"text-3xl font-bold text-grayconst createUser = async () => { try { const { $api } = useNuxtApp() await $api.post('/admin/users', userForm.value) closeModal() await loadUsers() alert('Utilisateur créé avec succès!') } catch (error) { console.error('Erreur lors de la création:', error) alert('Erreur lors de la création de l\\'utilisateur') } }center"},X={class:"bg-white rounded-lg shadow p-6 mb-6"},Y={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Z={class:"bg-white rounded-lg shadow overflow-hidden"},ee={class:"px-6 py-4 border-b border-gray-200"},te={class:"text-lg font-semibold text-gray-900"},se={key:0,class:"p-8 text-center"},ae={key:1,class:"overflow-x-auto"},le={class:"min-w-full divide-y divide-gray-200"},oe={class:"bg-white divide-y divide-gray-200"},re={class:"px-6 py-4 whitespace-nowrap"},ie={class:"flex items-center"},ne={class:"flex-shrink-0 h-10 w-10"},de={class:"h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center"},ue={class:"text-sm font-medium text-primary-600"},ce={class:"ml-4"},me={class:"text-sm font-medium text-gray-900"},ve={class:"text-sm text-gray-500"},pe={class:"px-6 py-4 whitespace-nowrap"},xe={class:"px-6 py-4 whitespace-nowrap"},ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},fe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ye={class:"flex space-x-2"},be=["onClick"],he=["onClick"],we={class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},_e={class:"flex-1 flex justify-between sm:hidden"},ke=["disabled"],Ue=["disabled"],Ce={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Me={class:"text-sm text-gray-700"},$e={class:"font-medium"},Ee={class:"font-medium"},Ae={class:"font-medium"},Ve={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},Se=["onClick"],Re={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Ne={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},De={class:"mt-3"},Pe={class:"text-lg font-medium text-gray-900 mb-4"},ze={key:0},je={key:1},qe={class:"flex justify-end space-x-3"},Fe={type:"submit",class:"btn-primary"},Ge={__name:"users",setup(Le){const U=u(!0),C=u(!1),v=u(!1),p=u([]),i=u(1),h=u(10),x=u(0),f=u(0),l=u({search:"",role:"",status:""}),o=u({id:null,name:"",email:"",role:"student",password:"",password_confirmation:""}),N=T(()=>{const a=[],t=Math.max(1,i.value-2),d=Math.min(f.value,i.value+2);for(let s=t;s<=d;s++)a.push(s);return a}),D=a=>({admin:"bg-red-100 text-red-800",teacher:"bg-green-100 text-green-800",student:"bg-blue-100 text-blue-800"})[a]||"bg-gray-100 text-gray-800",P=a=>({admin:"Admin",teacher:"Enseignant",student:"Élève"})[a]||a,z=a=>new Date(a).toLocaleDateString("fr-FR"),y=async()=>{var a;U.value=!0;try{const{$api:t}=_(),d=new URLSearchParams({page:i.value,per_page:h.value});l.value.search&&l.value.search.trim()&&d.append("search",l.value.search.trim()),l.value.role&&l.value.role.trim()&&d.append("role",l.value.role.trim()),l.value.status&&l.value.status.trim()&&d.append("status",l.value.status.trim()),console.log("Paramètres envoyés:",d.toString());const s=await t.get(`/admin/users?${d}`);console.log("Response complète:",s),console.log("Response.data:",s.data);const n=s.data||s;n.success&&n.data?(p.value=n.data,x.value=n.data.length,f.value=Math.ceil(x.value/h.value),console.log("Utilisateurs chargés:",p.value.length)):Array.isArray(n)?(p.value=n,x.value=n.length,f.value=Math.ceil(x.value/h.value),console.log("Utilisateurs chargés (tableau direct):",p.value.length)):(console.warn("Structure de réponse inattendue:",n),p.value=[],x.value=0,f.value=0)}catch(t){console.error("Erreur lors du chargement des utilisateurs:",t),console.error("Détails de l'erreur:",(a=t.response)==null?void 0:a.data),p.value=[],x.value=0,f.value=0}finally{U.value=!1}},M=a=>{a>=1&&a<=f.value&&(i.value=a,y())},j=async()=>{try{const{$api:a}=_();await a.post("/admin/users",{...o.value,password_confirmation:o.value.password}),$(),await y(),alert("Utilisateur créé avec succès!")}catch(a){console.error("Erreur lors de la création:",a),alert("Erreur lors de la création de l'utilisateur")}},q=a=>{o.value={id:a.id,name:a.name,email:a.email,role:a.role,password:""},v.value=!0},F=async()=>{try{const{$api:a}=_();await a.put(`/admin/users/${o.value.id}`,o.value),$(),await y(),alert("Utilisateur modifié avec succès!")}catch(a){console.error("Erreur lors de la modification:",a),alert("Erreur lors de la modification de l'utilisateur")}},L=async a=>{try{const{$api:t}=_();await t.patch(`/admin/users/${a.id}/toggle-status`),a.is_active=!a.is_active,alert(`Utilisateur ${a.is_active?"activé":"désactivé"} avec succès!`)}catch(t){console.error("Erreur lors du changement de statut:",t),alert("Erreur lors du changement de statut")}},$=()=>{C.value=!1,v.value=!1,o.value={id:null,name:"",email:"",role:"student",password:"",password_confirmation:""}};return B(l,()=>{i.value=1,y()},{deep:!0}),G(()=>{y()}),(a,t)=>{const d=I;return m(),c("div",J,[e("div",K,[e("div",O,[e("div",Q,[e("div",null,[e("h1",W,[V(d,{icon:"helmet",class:"mr-3 text-primary-600",size:32}),t[12]||(t[12]=b(" Gestion des Utilisateurs ",-1))]),t[13]||(t[13]=e("p",{class:"mt-2 text-gray-600"},"Gérez tous les utilisateurs de la plateforme",-1))]),e("button",{onClick:t[0]||(t[0]=s=>C.value=!0),class:"btn-primary flex items-center"},[V(d,{icon:"horseshoe",class:"mr-2",size:16}),t[14]||(t[14]=b(" Nouvel utilisateur ",-1))])])]),e("div",X,[e("div",Y,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rechercher",-1)),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.search=s),type:"text",placeholder:"Nom ou email...",class:"input-field"},null,512),[[w,l.value.search]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rôle",-1)),g(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.role=s),class:"input-field"},t[16]||(t[16]=[e("option",{value:""},"Tous les rôles",-1),e("option",{value:"admin"},"Administrateur",-1),e("option",{value:"teacher"},"Enseignant",-1),e("option",{value:"student"},"Élève",-1)]),512),[[A,l.value.role]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Statut",-1)),g(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.status=s),class:"input-field"},t[18]||(t[18]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"active"},"Actif",-1),e("option",{value:"inactive"},"Inactif",-1)]),512),[[A,l.value.status]])]),e("div",{class:"flex items-end"},[e("button",{onClick:y,class:"btn-outline w-full"}," Filtrer ")])])]),e("div",Z,[e("div",ee,[e("h2",te," Liste des utilisateurs ("+r(p.value.length)+") ",1)]),U.value?(m(),c("div",se,t[20]||(t[20]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"},null,-1),e("p",{class:"mt-2 text-gray-500"},"Chargement...",-1)]))):(m(),c("div",ae,[e("table",le,[t[21]||(t[21]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Utilisateur "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Rôle "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Inscription "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",oe,[(m(!0),c(S,null,R(p.value,s=>(m(),c("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",re,[e("div",ie,[e("div",ne,[e("div",de,[e("span",ue,r(s.name.charAt(0).toUpperCase()),1)])]),e("div",ce,[e("div",me,r(s.name),1),e("div",ve,r(s.email),1)])])]),e("td",pe,[e("span",{class:k([D(s.role),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},r(P(s.role)),3)]),e("td",xe,[e("span",{class:k([s.is_active?"text-green-800 bg-green-100":"text-red-800 bg-red-100","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},r(s.is_active?"Actif":"Inactif"),3)]),e("td",ge,r(z(s.created_at)),1),e("td",fe,[e("div",ye,[e("button",{onClick:n=>q(s),class:"text-indigo-600 hover:text-indigo-900"}," Modifier ",8,be),e("button",{onClick:n=>L(s),class:k(s.is_active?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900")},r(s.is_active?"Désactiver":"Activer"),11,he)])])]))),128))])])])),e("div",we,[e("div",_e,[e("button",{disabled:i.value<=1,onClick:t[4]||(t[4]=s=>M(i.value-1)),class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Précédent ",8,ke),e("button",{disabled:i.value>=f.value,onClick:t[5]||(t[5]=s=>M(i.value+1)),class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Suivant ",8,Ue)]),e("div",Ce,[e("div",null,[e("p",Me,[t[22]||(t[22]=b(" Affichage de ",-1)),e("span",$e,r((i.value-1)*h.value+1),1),t[23]||(t[23]=b(" à ",-1)),e("span",Ee,r(Math.min(i.value*h.value,x.value)),1),t[24]||(t[24]=b(" sur ",-1)),e("span",Ae,r(x.value),1),t[25]||(t[25]=b(" résultats ",-1))])]),e("div",null,[e("nav",Ve,[(m(!0),c(S,null,R(N.value,s=>(m(),c("button",{key:s,onClick:n=>M(s),class:k([s===i.value?"bg-primary-50 border-primary-500 text-primary-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},r(s),11,Se))),128))])])])])])]),C.value||v.value?(m(),c("div",Re,[e("div",Ne,[e("div",De,[e("h3",Pe,r(v.value?"Modifier l'utilisateur":"Créer un nouvel utilisateur"),1),e("form",{onSubmit:t[11]||(t[11]=H(s=>v.value?F():j(),["prevent"])),class:"space-y-4"},[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700"},"Nom",-1)),g(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.name=s),type:"text",class:"input-field",required:""},null,512),[[w,o.value.name]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),g(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.email=s),type:"email",class:"input-field",required:""},null,512),[[w,o.value.email]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700"},"Rôle",-1)),g(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.role=s),class:"input-field",required:""},t[28]||(t[28]=[e("option",{value:"student"},"Élève",-1),e("option",{value:"teacher"},"Enseignant",-1),e("option",{value:"admin"},"Administrateur",-1)]),512),[[A,o.value.role]])]),v.value?E("",!0):(m(),c("div",ze,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700"},"Mot de passe",-1)),g(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>o.value.password=s),type:"password",class:"input-field",required:""},null,512),[[w,o.value.password]])])),v.value?E("",!0):(m(),c("div",je,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700"},"Confirmer le mot de passe",-1)),g(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>o.value.password_confirmation=s),type:"password",class:"input-field",required:""},null,512),[[w,o.value.password_confirmation]])])),e("div",qe,[e("button",{type:"button",onClick:$,class:"btn-outline"},"Annuler"),e("button",Fe,r(v.value?"Modifier":"Créer"),1)])],32)])])])):E("",!0)])}}};export{Ge as default};
